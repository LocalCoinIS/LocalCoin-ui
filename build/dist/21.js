(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{106:function(e,t,a){"use strict";var n=a(0),o=a.n(n),r=a(503),s=a.n(r),i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var c=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={animateEnter:!1},e.timer=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.a.Component),i(t,[{key:"componentDidMount",value:function(){this.enableAnimation()}},{key:"resetAnimation",value:function(){this.setState({animateEnter:!1}),this.enableAnimation()}},{key:"enableAnimation",value:function(){var e=this;this.timer=setTimeout(function(){e.timer&&e.setState({animateEnter:!0})},2e3)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){return this.props.children?o.a.createElement(s.a,{className:this.props.className,component:this.props.component,transitionName:this.props.transitionName,transitionEnterTimeout:this.props.enterTimeout,transitionEnter:this.state.animateEnter,transitionLeave:!1},this.props.children):o.a.createElement(this.props.component)}}]),t}();c.defaultProps={component:"span",enterTimeout:2e3},t.a=c},107:function(e,t,a){"use strict";var n=a(0),o=a.n(n),r=a(5),s=a(16),i=a(90),c=a(14),l=a(23),u=a(1),p=a.n(u),m=a(4),h=a(7),d=a(13),f=a(8),b=a.n(f),g=a(3),v=a.n(g),y=a(12),_=a(64),E=a(165),k=a(346),w=a(2),A=a.n(w),S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},C=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var N=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={inputChanged:!1},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.a.Component),C(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.account,a=e.accountName;void 0===t&&(t=m.b.getAccount(a)),this.props.onAccountChanged&&t&&this.props.onAccountChanged(t),!this.props.typeahead&&a&&this.onInputChanged(a)}},{key:"componentWillReceiveProps",value:function(e){e.account&&e.account!==this.props.account&&this.props.onAccountChanged(e.account)}},{key:"getAccount",value:function(){return this.props.account}},{key:"getError",value:function(){var e=this.props,t=e.account,a=e.error;return a||!t||this.getInputType(t.get("name"))||(a=v.a.translate("account.errors.invalid")),a}},{key:"getInputType",value:function(e){return e?"#"===e[0]&&r.a.is_object_id("1.2."+e.substring(1))?"id":m.d.is_account_name(e,!0)?"name":this.props.allowPubKey&&m.i.fromPublicKeyString(e)?"pubkey":null:null}},{key:"onSelected",value:function(e){this.setState({inputChanged:!1});var t=this.getVerifiedAccountName(e),a=m.b.getAccount(t);a&&(this.props.onChange(t),this.props.onAccountChanged(a))}},{key:"onInputChanged",value:function(e){var t=this.props,a=t.onChange,n=t.onAccountChanged,o=t.accountName,r=t.typeahead;this.setState({inputChanged:!0});var s=this.getVerifiedAccountName(e),i=m.b.getAccount(s);a&&s!==o&&a(s),r||(a&&a(s),n&&n(i))}},{key:"getVerifiedAccountName",value:function(e){var t=this.props.allowUppercase,a=null;a="string"==typeof e?e:e&&e.target?e.target.value.trim():"",t||(a=a.toLowerCase());var n=a.replace("#","").match(/(?:\/account\/)(.*)(?:\/overview)/);return n&&(a=n[1]),a}},{key:"onKeyDown",value:function(e){13===e.keyCode&&this.onAction(e)}},{key:"_onAddContact",value:function(){l.a.addAccountContact(this.props.accountName)}},{key:"_onRemoveContact",value:function(){l.a.removeAccountContact(this.props.accountName)}},{key:"onAction",value:function(e){var t=this.props,a=t.onAction,n=t.disableActionButton,o=t.account,r=t.accountName;e.preventDefault(),this.getError()||!a||n||(o?a(o):"pubkey"===this.getInputType(r)&&a(r))}},{key:"render",value:function(){var e=this.props,t=e.accountName,a=e.account,n=e.allowPubKey,r=e.typeahead,s=e.disableActionButton,c=e.contacts,l=e.myActiveAccounts,u=(e.noPlaceHolder,e.useHR),h=e.labelClass,d=e.reserveErrorSpace,f=this.getInputType(t),g=[],w=this.getError(),A=l;A=A.concat(c);var C=void 0;a&&(a.isKnownScammer=_.a.isKnownScammer(a.get("name")),a.accountType=this.getInputType(a.get("name")),a.accountStatus=m.b.getAccountMemberStatus(a),a.statusText=a.isKnownScammer?v.a.translate("account.member.suspected_scammer"):v.a.translate("account.member."+a.accountStatus),C="name"===a.accountType?"#"+a.get("id").substring(4):"id"===a.accountType?a.get("name"):null),r?n&&"pubkey"===f||w||!t||a||(w=v.a.translate("account.errors.unknown")):!a&&t&&"pubkey"!==f&&(w=v.a.translate("account.errors.unknown")),n&&"pubkey"===f&&(C="Public Key"),a&&A&&(a.isFavorite=l.has(a.get("name"))||c.has(a.get("name"))),r&&A&&A.map(function(e){var t=m.b.getAccount(e),a=m.b.getAccountMemberStatus(t),n=_.a.isKnownScammer(e)?"account.member.suspected_scammer":"account.member."+a;g.push({id:e,label:e,status:v.a.translate(n),className:_.a.isKnownScammer(e)?"negative":"positive"})});var N=!!t&&g.reduce(function(e,a){return e||a.label===t},!1);if(t&&!N&&this.state.inputChanged){var x=m.b.getAccount(t),O=x?m.b.getAccountMemberStatus(x):null,I=x?_.a.isKnownScammer(x.get("name"))?v.a.translate("account.member.suspected_scammer"):v.a.translate("account.member."+O):v.a.translate("account.errors.unknown");g.push({id:this.props.accountName,label:this.props.accountName,status:I,className:_.a.isKnownScammer(t)||!x?"negative":null,disabled:!x})}g.sort(function(e,t){return e.label>t.label?1:-1});var T=this.props.account?l.has(a.get("name"))||c.has(a.get("name"))?o.a.createElement("span",{className:"tooltip green","data-place":"top","data-tip":v.a.translate("tooltip.follow_user"),onClick:this._onRemoveContact.bind(this)},o.a.createElement(y.a,{style:{position:"absolute",top:"-0.15em",right:".2em"},name:"user",title:"icons.user.following"})):o.a.createElement("span",{className:"tooltip","data-place":"top","data-tip":v.a.translate("tooltip.follow_user_add"),onClick:this._onAddContact.bind(this)},o.a.createElement(y.a,{style:{position:"absolute",top:"-0.05em",right:".2em"},name:"plus-circle",title:"icons.plus_circle.add_contact"})):null,j=b()("button",{disabled:!(a||"pubkey"===f)||w||s});return o.a.createElement("div",{className:"account-selector",style:this.props.style},o.a.createElement("div",{className:"content-area"},this.props.label?o.a.createElement("div",{className:"header-area"+(this.props.hideImage?" no-margin":"")},o.a.createElement("label",{className:b()("right-label",a&&a.isFavorite?"positive":null,a&&a.isKnownScammer?"negative":null)},o.a.createElement("span",{style:{paddingRight:"1.5rem"}},a&&a.statusText," ",!!C&&C),T),o.a.createElement(p.a,{className:"left-label "+(h||""),component:"label",content:this.props.label}),u&&o.a.createElement("hr",null)):null,o.a.createElement("div",{className:"input-area"},o.a.createElement("div",{className:"inline-label input-wrapper"},a&&"pubkey"===a.accountType?o.a.createElement("div",{className:"account-image"},o.a.createElement(y.a,{name:"key",title:"icons.key",size:"4x"})):this.props.hideImage?null:o.a.createElement(i.a,{size:{height:this.props.size||80,width:this.props.size||80},account:a?a.get("name"):null,custom_image:null}),void 0!==this.props.typeahead?o.a.createElement(k.a,S({items:g,style:{textTransform:"pubkey"===this.getInputType(t)?null:"lowercase",fontVariant:"initial"},name:"username",id:"username",defaultValue:this.props.accountName||"",placeholder:this.props.placeholder||v.a.translate("account.name"),ref:"user_input",onSelect:this.onSelected.bind(this),onChange:this.onInputChanged.bind(this),onKeyDown:this.onKeyDown.bind(this),tabIndex:this.props.tabIndex,inputProps:{placeholder:"Search for an account"}},this.props.typeaheadOptions||{})):o.a.createElement("input",{style:{textTransform:"pubkey"===this.getInputType(t)?null:"lowercase",fontVariant:"initial"},name:"username",id:"username",type:"text",value:this.props.accountName||"",placeholder:this.props.placeholder||v.a.translate("account.name"),ref:"user_input",onChange:this.onInputChanged.bind(this),onKeyDown:this.onKeyDown.bind(this),tabIndex:this.props.tabIndex}),this.props.dropDownContent?o.a.createElement("div",{className:"form-label select floating-dropdown"},o.a.createElement(E.a,{entries:this.props.dropDownContent,values:this.props.dropDownContent.reduce(function(e,t){return t&&(e[t]=t),e},{}),singleEntry:this.props.dropDownContent[0],value:this.props.dropDownValue||"",onChange:this.props.onDropdownSelect})):null,this.props.children,this.props.onAction?o.a.createElement("button",{className:j,onClick:this.onAction.bind(this)},o.a.createElement(p.a,{content:this.props.action_label})):null)),w||d?o.a.createElement("div",{className:this.props.hideImage?"has-error":"error-area",style:{marginTop:"1rem"}},o.a.createElement("span",null,w)):null))}}]),t}();N.propTypes={label:A.a.string,error:A.a.element,placeholder:A.a.string,onChange:A.a.func,onAccountChanged:A.a.func,onAction:A.a.func,accountName:A.a.string,account:h.a.ChainAccount,tabIndex:A.a.number,disableActionButton:A.a.bool,allowUppercase:A.a.bool,typeahead:A.a.array},N.defaultProps={autosubscribe:!1},N=Object(d.a)(N),N=Object(s.connect)(N,{listenTo:function(){return[c.a]},getProps:function(){return{myActiveAccounts:c.a.getState().myActiveAccounts,contacts:c.a.getState().accountContacts}}}),t.a=N},168:function(e,t,a){"use strict";a.d(t,"a",function(){return j}),a.d(t,"b",function(){return P});var n=a(0),o=a.n(n),r=a(1),s=a.n(r),i=a(120),c=a(143),l=a(7),u=a(13),p=a(5),m=a(4),h=a(106),d=a(54),f=a.n(d),b=a(3),g=a.n(b),v=a(12),y=a(8),_=a.n(y),E=a(2),k=a.n(E),w=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var N=m.c.operations,x={textAlign:"left"},O={textAlign:"right"};function I(e,t){return t.block_num===e.block_num?t.virtual_op-e.virtual_op:t.block_num-e.block_num}function T(e){return e?'"'+e.textContent.replace(/[\s\t\r\n]/gi," ")+'"':""}var j=function(e){function t(e){A(this,t);var a=S(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.state={limit:e.limit||20,csvExport:!1,headerHeight:85,filter:"all"},a}return C(t,o.a.Component),w(t,[{key:"componentDidMount",value:function(){if(!this.props.fullHeight){var e=this.refs.transactions;f.a.initialize(e),this._setHeaderHeight()}}},{key:"_setHeaderHeight",value:function(){var e=this.refs.header.offsetHeight;e!==this.state.headerHeight&&this.setState({headerHeight:e})}},{key:"shouldComponentUpdate",value:function(e,t){if(!p.a.are_equal_shallow(this.props.accountsList,e.accountsList))return!0;if(this.props.maxHeight!==e.maxHeight)return!0;if(this.state.headerHeight!==t.headerHeight)return!0;if(this.state.filter!==t.filter)return!0;if(this.props.customFilter&&(!p.a.are_equal_shallow(this.props.customFilter.fields,e.customFilter.fields)||!p.a.are_equal_shallow(this.props.customFilter.values,e.customFilter.values)))return!0;if(this.props.maxHeight!==e.maxHeight)return!0;if(t.limit!==this.state.limit||t.csvExport!==this.state.csvExport)return!0;for(var a=0;a<e.accountsList.length;++a){var n=e.accountsList[a],o=this.props.accountsList[a];if(n&&o&&n.get("history")!==o.get("history"))return!0}return!1}},{key:"componentDidUpdate",value:function(){if(this.state.csvExport){this.state.csvExport=!1;var e=document.getElementById("csv_export_container").childNodes,t="",a=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(a=(r=s.next()).done);a=!0){var c=r.value.childNodes;""!==t&&(t+="\n"),t+=[T(c[0]),T(c[1]),T(c[2]),T(c[3])].join(",")}}catch(e){n=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw o}}var l=new Blob([t],{type:"text/csv;charset=utf-8"}),u=new Date;Object(i.saveAs)(l,"btshist-"+u.getFullYear()+"-"+("0"+(u.getMonth()+1)).slice(-2)+"-"+("0"+u.getDate()).slice(-2)+"-"+("0"+u.getHours()).slice(-2)+("0"+u.getMinutes()).slice(-2)+".csv")}if(!this.props.fullHeight){var p=this.refs.transactions;f.a.update(p),this._setHeaderHeight()}}},{key:"_onIncreaseLimit",value:function(){this.setState({limit:this.state.limit+30})}},{key:"_getHistory",value:function(e,t,a){var n=[],o=new Set,r=!0,s=!1,i=void 0;try{for(var c,l=e[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var u=c.value;if(u){var p=u.get("history");p&&(n=n.concat(p.toJS().filter(function(e){return!o.has(e.id)&&o.add(e.id)})))}}}catch(e){s=!0,i=e}finally{try{!r&&l.return&&l.return()}finally{if(s)throw i}}return t&&(n=n.filter(function(e){return e.op[0]===N[t]})),a&&(n=n.filter(function(e){return a.fields.reduce(function(t,n){switch(n){case"asset_id":return t&&e.op[1].amount[n]===a.values[n];default:return t&&e.op[1][n]===a.values[n]}},!0)})),n}},{key:"_downloadCSV",value:function(){this.setState({csvExport:!0})}},{key:"_onChangeFilter",value:function(e){this.setState({filter:e.target.value})}},{key:"render",value:function(){var e=this.props,t=e.accountsList,a=e.compactView,n=e.filter,r=e.customFilter,i=e.style,l=e.maxHeight,u=this.state,p=u.limit,m=u.headerHeight,d=1===t.length&&t[0]?t[0].get("id"):null,f=this._getHistory(t,this.props.showFilters&&"all"!==this.state.filter?this.state.filter:n,r).sort(I),b=f.length,y=null;y=["all","transfer","limit_order_create","limit_order_cancel","fill_order","account_create","account_update","asset_create","witness_withdraw_pay","vesting_balance_withdraw"].map(function(e){return o.a.createElement("option",{value:e,key:e},g.a.translate("transaction.trxTypes."+e))});var E=f.length?f.slice(0,p).map(function(e){return o.a.createElement(c.a,{includeOperationId:!0,operationId:e.id,style:x,key:e.id,op:e.op,result:e.result,block:e.block_num,current:d,hideFee:!0,inverted:!1,hideOpLabel:a,fullDate:!0})}):[o.a.createElement("tr",{key:"no_recent"},o.a.createElement("td",{colSpan:a?"2":"3"},o.a.createElement(s.a,{content:"operation.no_recent"})))];return E.push(o.a.createElement("tr",{className:"total-value",key:"total_value"},o.a.createElement("td",{className:"column-hide-tiny"}),o.a.createElement("td",{style:O},b>0?o.a.createElement("span",null,o.a.createElement("a",{className:"inline-block",onClick:this._downloadCSV.bind(this),"data-tip":g.a.translate("transaction.csv_tip"),"data-place":"bottom"},o.a.createElement(v.a,{name:"excel",title:"icons.excel",className:"icon-14px"}))):null),o.a.createElement("td",{style:{textAlign:"center"}}," ",this.props.showMore&&b>this.props.limit||p<b?o.a.createElement("a",{onClick:this._onIncreaseLimit.bind(this)},o.a.createElement(v.a,{name:"chevron-down",title:"icons.chevron_down.transactions",className:"icon-14px"})):null))),o.a.createElement("div",{className:"recent-transactions no-overflow",style:i},o.a.createElement("div",{className:"generic-bordered-box"},this.props.dashboard?null:o.a.createElement("div",{ref:"header"},o.a.createElement("div",{className:"block-content-header"},o.a.createElement("span",null,this.props.title?this.props.title:o.a.createElement(s.a,{content:"account.recent"})))),o.a.createElement("div",{className:"header-selector"},o.a.createElement("div",{className:"selector"},o.a.createElement("div",{className:_()("inline-block")},this.props.showFilters?o.a.createElement("select",{"data-place":"left","data-tip":g.a.translate("tooltip.filter_ops"),style:{paddingTop:5,width:"auto"},className:"bts-select no-margin",value:this.state.filter,onChange:this._onChangeFilter.bind(this)},y):null))),o.a.createElement("div",{className:"box-content grid-block no-margin",style:this.props.fullHeight?null:{maxHeight:l-m},ref:"transactions"},o.a.createElement("table",{className:"table table-striped "+(a?"compact":"")+(this.props.dashboard?" dashboard-table table-hover":"")},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{className:"column-hide-tiny",style:x},o.a.createElement(s.a,{content:"account.transactions.id"})),o.a.createElement("th",{className:"column-hide-tiny",style:x},o.a.createElement(s.a,{content:"account.transactions.type"})),o.a.createElement("th",{style:x},o.a.createElement(s.a,{content:"account.transactions.info"})),o.a.createElement("th",{style:x},o.a.createElement(s.a,{content:"account.transactions.time"})))),o.a.createElement(h.a,{component:"tbody",transitionName:"newrow"},E))),b>0&&this.state.csvExport&&o.a.createElement("div",{id:"csv_export_container",style:{display:"none"}},o.a.createElement("div",null,o.a.createElement("div",null,"DATE"),o.a.createElement("div",null,"OPERATION"),o.a.createElement("div",null,"MEMO"),o.a.createElement("div",null,"AMOUNT")),f.map(function(e){return o.a.createElement(c.a,{key:e.id,op:e.op,result:e.result,block:e.block_num,inverted:!1,csvExportMode:!0})}))))}}]),t}();j.propTypes={accountsList:l.a.ChainAccountsList.isRequired,compactView:k.a.bool,limit:k.a.number,maxHeight:k.a.number,fullHeight:k.a.bool,showFilters:k.a.bool},j.defaultProps={limit:25,maxHeight:500,fullHeight:!1,showFilters:!1},j=Object(u.a)(j);var P=function(e){function t(){return A(this,t),S(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return C(t,o.a.Component),w(t,[{key:"render",value:function(){return o.a.createElement("span",{className:"wrapper"},this.props.children(this.props))}}]),t}();P.propTypes={asset:l.a.ChainAsset.isRequired,to:l.a.ChainAccount.isRequired,fromAccount:l.a.ChainAccount.isRequired},P.defaultProps={asset:"1.3.0"},P=Object(u.a)(P)},7813:function(e,t,a){"use strict";a.r(t),function(e){var n=a(391),o=a(85),r=a(0),s=a.n(r),i=a(61),c=a(23),l=a(1),u=a.n(l),p=a(110),m=a(107),h=a(14),d=a(46),f=a(5),b=a(3),g=a.n(b),v=a(45),y=a(168),_=a(6),E=a.n(_),k=a(4),w=a(16),A=a(40),S=a(8),C=a.n(S),N=a(19),x=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var O=function(t){function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e)),n=a.getInitialState(),r=t.props.location.query;r.from&&(n.from_name=r.from,k.b.getAccount(r.from)),r.to&&(n.to_name=r.to,k.b.getAccount(r.to)),r.amount&&(n.amount=r.amount),r.asset&&(n.asset_id=r.asset,n.asset=k.b.getAsset(r.asset)),r.memo&&(n.memo=r.memo);var s=h.a.getState().currentAccount;return n.from_name||(n.from_name=s),t.state=n,t.onTrxIncluded=t.onTrxIncluded.bind(t),t._updateFee=Object(o.a)(t._updateFee.bind(t),250),t._checkFeeStatus=t._checkFeeStatus.bind(t),t._checkBalance=t._checkBalance.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,s.a.Component),x(a,[{key:"componentWillMount",value:function(){this.nestedRef=null,this._updateFee(),this._checkFeeStatus()}},{key:"shouldComponentUpdate",value:function(e,t){var a=this._getAvailableAssets().asset_types,n=this._getAvailableAssets(t).asset_types;if(1===n.length){var o=k.b.getAsset(n[0]);1!==a.length&&this.onAmountChanged({amount:t.amount,asset:o}),n[0]!==this.state.fee_asset_id&&o&&this.state.fee_asset_id!==n[0]&&this.setState({feeAsset:o,fee_asset_id:n[0]})}return!0}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.currentAccount!==this.state.from_name&&e.currentAccount!==this.props.currentAccount&&this.setState({from_name:e.currentAccount,from_account:k.b.getAccount(e.currentAccount),feeStatus:{},fee_asset_id:"1.3.0",feeAmount:new N.a({amount:0})},function(){t._updateFee(),t._checkFeeStatus(k.b.getAccount(e.currentAccount))})}},{key:"_checkBalance",value:function(){var e=this.state,t=e.feeAmount,a=e.amount,n=e.from_account,o=e.asset;if(o&&n){var r=n.getIn(["balances",o.get("id")]),s=n.getIn(["balances",t.asset_id]);if(o&&n){if(!r)return this.setState({balanceError:!0});var i=k.b.getObject(r),c=s?k.b.getObject(s):null;if(c&&0!==c.get("balance")||this.setState({fee_asset_id:"1.3.0"},this._updateFee),i&&t){var l=Object(A.a)(a,o,t,i);null!==l&&this.setState({balanceError:!l})}}}}},{key:"_checkFeeStatus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.from_account;if(t){var a=Object.keys(t.get("balances").toJS()).sort(f.a.sortID),n={},o=[];a.forEach(function(a){o.push(Object(A.b)({accountID:t.get("id"),feeID:a,options:["price_per_kbyte"],data:{type:"memo",content:e.state.memo}}))}),Promise.all(o).then(function(t){a.forEach(function(e,a){n[e]=t[a]}),f.a.are_equal_shallow(e.state.feeStatus,n)||e.setState({feeStatus:n}),e._checkBalance()}).catch(function(e){console.error(e)})}}},{key:"_updateFee",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,a=t.fee_asset_id,n=t.from_account,o=t.asset_id,r=this._getAvailableAssets(t).fee_asset_types;if(1===r.length&&r[0]!==a&&(a=r[0]),!n)return null;Object(A.b)({accountID:n.get("id"),feeID:a,options:["price_per_kbyte"],data:{type:"memo",content:t.memo}}).then(function(t){var a=t.fee,r=t.hasBalance,s=t.hasPoolBalance;return Object(A.d)(n,a).then(function(t){return t?e.setState({fee_asset_id:o},e._updateFee):e.setState({feeAmount:a,fee_asset_id:a.asset_id,hasBalance:r,hasPoolBalance:s,error:!r||!s})})})}},{key:"fromChanged",value:function(e){e||this.setState({from_account:null}),this.setState({from_name:e,error:null,propose:!1,propose_account:""})}},{key:"toChanged",value:function(e){this.setState({to_name:e,error:null})}},{key:"onFromAccountChanged",value:function(e){var t=this;this.setState({from_account:e,error:null},function(){t._updateFee(),t._checkFeeStatus()})}},{key:"onToAccountChanged",value:function(e){this.setState({to_account:e,error:null})}},{key:"onAmountChanged",value:function(e){var t=e.amount,a=e.asset;a&&this.setState({amount:t,asset:a,asset_id:a.get("id"),error:null},this._checkBalance)}},{key:"onFeeChanged",value:function(e){var t=e.asset;this.setState({feeAsset:t,fee_asset_id:t.get("id"),error:null},this._updateFee)}},{key:"onMemoChanged",value:function(e){this.setState({memo:e.target.value},this._updateFee)}},{key:"onTrxIncluded",value:function(e){e.included&&e.broadcasted_transaction?(v.a.unlisten(this.onTrxIncluded),v.a.reset()):e.closed&&(v.a.unlisten(this.onTrxIncluded),v.a.reset())}},{key:"onPropose",value:function(e,t){t.preventDefault(),this.setState({propose:e,propose_account:null})}},{key:"onProposeAccount",value:function(e){this.setState({propose_account:e})}},{key:"resetForm",value:function(){this.setState({memo:"",to_name:"",amount:""})}},{key:"onSubmit",value:function(t){var a=this;t.preventDefault(),this.setState({error:null});var n=this.state,o=n.asset,r=n.amount,s=new N.a({real:r,asset_id:o.get("id"),precision:o.get("precision")});c.a.transfer(this.state.from_account.get("id"),this.state.to_account.get("id"),s.getAmount(),o.get("id"),this.state.memo?new e(this.state.memo,"utf-8"):this.state.memo,this.state.propose?this.state.propose_account:null,this.state.feeAsset?this.state.feeAsset.get("id"):"1.3.0").then(function(){a.resetForm.call(a),v.a.unlisten(a.onTrxIncluded),v.a.listen(a.onTrxIncluded)}).catch(function(e){var t=e.message?e.message.split("\n")[1]||e.message:null;console.log("error: ",e,t),a.setState({error:t})})}},{key:"setNestedRef",value:function(e){this.nestedRef=e}},{key:"_setTotal",value:function(e,t){var a=this.state.feeAmount,n=k.b.getObject(t),o=k.b.getObject(e),r=new N.a({amount:n.get("balance"),asset_id:o.get("id"),precision:o.get("precision")});n&&(a.asset_id===r.asset_id&&r.minus(a),this.setState({amount:r.getAmount({real:!0})},this._checkBalance))}},{key:"_getAvailableAssets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,t=this.state.feeStatus;var a=e.from_account,n=e.from_error,o=[],r=[];if(!a||!a.get("balances")||n)return{asset_types:o,fee_asset_types:r};var s=e.from_account.get("balances").toJS();for(var i in o=Object.keys(s).sort(f.a.sortID),r=Object.keys(s).sort(f.a.sortID),s){var c=k.b.getObject(s[i]);c&&0===c.get("balance")&&(o.splice(o.indexOf(i),1),-1!==r.indexOf(i)&&r.splice(r.indexOf(i),1))}return{asset_types:o,fee_asset_types:r=r.filter(function(e){return(void 0===t[a=e]||t[a]&&t[a].hasPoolBalance)&&function(e){return void 0===t[e]||t[e]&&t[e].hasBalance}(e);var a})}}},{key:"render",value:function(){var e=null,t=this.state,a=t.propose,o=t.from_account,r=t.to_account,c=t.asset,l=t.asset_id,f=t.propose_account,b=t.feeAmount,v=t.amount,_=t.error,w=t.to_name,A=t.from_name,S=t.memo,N=t.feeAsset,x=t.fee_asset_id,O=t.balanceError,I=h.a.isMyAccount(o)||A===this.props.passwordAccount;!o||I||a||(e=s.a.createElement("span",null,g.a.translate("account.errors.not_yours")," (",s.a.createElement("a",{onClick:this.onPropose.bind(this,!0)},g.a.translate("propose")),")"));var T=this._getAvailableAssets(),j=T.asset_types,P=T.fee_asset_types,F=null,H=this.state.feeAmount.getAmount({real:!0});if(o&&o.get("balances")&&!e){var D=o.get("balances").toJS();if(1===j.length&&(c=k.b.getAsset(j[0])),j.length>0){var B=c?c.get("id"):j[0],R=N?N.get("id"):"1.3.0";F=s.a.createElement("span",{style:{borderBottom:"#A09F9F 1px dotted",cursor:"pointer"},onClick:this._setTotal.bind(this,B,D[B],H,R)},s.a.createElement(u.a,{component:"span",content:"transfer.available"}),":"," ",s.a.createElement(i.a,{balance:D[B]}))}else F="No funds"}var M=a&&!f,K=parseFloat(String.prototype.replace.call(v,/,/g,"")),L=K&&!Object(n.a)(K),V=r&&r.get("name")===w,q=!o||!V||!L||!c||e||M||O,z=E.a.Set();z=z.add(o);var U=1;return s.a.createElement("div",{className:"grid-block vertical"},s.a.createElement("div",{className:"grid-block shrink vertical medium-horizontal",style:{paddingTop:"2rem"}},s.a.createElement("form",{style:{paddingBottom:20,overflow:"visible"},className:"grid-content small-12 medium-6 large-5 large-offset-1 full-width-content",onSubmit:this.onSubmit.bind(this),noValidate:!0},s.a.createElement(u.a,{content:"transfer.header",component:"h2"}),s.a.createElement("div",{className:"content-block"},s.a.createElement(m.a,{label:"transfer.from",ref:"from",accountName:A,onChange:this.fromChanged.bind(this),onAccountChanged:this.onFromAccountChanged.bind(this),account:o,size:60,error:e,typeahead:!0,tabIndex:U++})),s.a.createElement("div",{className:"content-block"},s.a.createElement(m.a,{label:"transfer.to",ref:"to",accountName:w,onChange:this.toChanged.bind(this),onAccountChanged:this.onToAccountChanged.bind(this),account:r,size:60,tabIndex:U++,typeahead:!0})),s.a.createElement("div",{className:"content-block transfer-input"},s.a.createElement(d.a,{label:"transfer.amount",amount:v,onChange:this.onAmountChanged.bind(this),asset:j.length>0&&c?c.get("id"):l||j[0],assets:j,display_balance:F,tabIndex:U++}),this.state.balanceError?s.a.createElement("p",{className:"has-error no-margin",style:{paddingTop:10}},s.a.createElement(u.a,{content:"transfer.errors.insufficient"})):null),s.a.createElement("div",{className:"content-block transfer-input"},S&&S.length?s.a.createElement("label",{className:"right-label"},S.length):null,s.a.createElement(u.a,{className:"left-label tooltip",component:"label",content:"transfer.memo","data-place":"top","data-tip":g.a.translate("tooltip.memo_tip")}),s.a.createElement("textarea",{style:{marginBottom:0},rows:"3",value:S,tabIndex:U++,onChange:this.onMemoChanged.bind(this)}),this.state.propose?s.a.createElement("div",{className:"error-area",style:{position:"absolute"}},s.a.createElement(u.a,{content:"transfer.warn_name_unable_read_memo",name:this.state.from_name})):null),s.a.createElement("div",{className:"content-block transfer-input fee-row"+(this.state.propose?" proposal":"")},s.a.createElement(d.a,{refCallback:this.setNestedRef.bind(this),label:"transfer.fee",disabled:!0,amount:H,onChange:this.onFeeChanged.bind(this),asset:P.length&&b?b.asset_id:1===P.length?P[0]:x||P[0],assets:P,tabIndex:U++,error:!1===this.state.hasPoolBalance?"transfer.errors.insufficient":null}),a?s.a.createElement("button",{className:C()("button float-right no-margin",{disabled:q}),type:"submit",value:"Submit",tabIndex:U++},s.a.createElement(u.a,{component:"span",content:"propose"})):s.a.createElement("button",{className:C()("button float-right no-margin",{disabled:q}),type:"submit",value:"Submit",tabIndex:U++},s.a.createElement(u.a,{component:"span",content:"transfer.send"}))),a?s.a.createElement("div",{className:"full-width-content form-group transfer-input"},s.a.createElement("label",{className:"left-label"},s.a.createElement(u.a,{content:"account.propose_from"})),s.a.createElement(p.a,{account_names:h.a.getMyAccounts(),onChange:this.onProposeAccount.bind(this),tabIndex:U++})):null,_?s.a.createElement("div",{className:"content-block has-error"},_):null,s.a.createElement("div",null,a?s.a.createElement("span",null,s.a.createElement("button",{className:" button",onClick:this.onPropose.bind(this,!1),tabIndex:U++},s.a.createElement(u.a,{component:"span",content:"cancel"}))):null)),s.a.createElement("div",{className:"grid-content small-12 medium-6 large-4 large-offset-1 right-column"},s.a.createElement("div",{className:"grid-content no-padding"},s.a.createElement(y.a,{accountsList:z,limit:25,compactView:!0,filter:"transfer",fullHeight:!0}))),s.a.createElement("div",{className:"grid-content medium-6 large-4"})))}}],[{key:"getInitialState",value:function(){return{from_name:"",to_name:"",from_account:null,to_account:null,amount:"",asset_id:null,asset:null,memo:"",error:null,propose:!1,propose_account:"",feeAsset:null,fee_asset_id:"1.3.0",feeAmount:new N.a({amount:0}),feeStatus:{}}}}]),a}();t.default=Object(w.connect)(O,{listenTo:function(){return[h.a]},getProps:function(){return{currentAccount:h.a.getState().currentAccount,passwordAccount:h.a.getState().passwordAccount,contactsList:h.a.getState().accountContacts}}})}.call(this,a(30).Buffer)}}]);